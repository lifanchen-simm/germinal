# @package _global_
# scFv run configuration for PDL1

# General run settings
type: "scfv"
cdr_lengths: [8, 8, 18, 9, 3, 9] # heavy, then light
fw_lengths: [25,17,38,52,17,36,10]
pregenerate_seeds: false
vh_first: true
vh_len: 125
vl_len: 109
protocol: "dual_binder"
complex_path: ["pdbs/kp3-azd.pdb","pdbs/rbd-azd.pdb"]
dual_grad_sum: False #if false use PCGrad
clear_best_greedy: False #if true, takes seq from best design in soft but the final design gets chosen from Greedy
is_recover: True
recover_bias: 5

# Loss function parameters
weights_plddt: 0.5  #try 1
weights_i_plddt: 1.2
weights_pae_intra: 0.1
weights_pae_inter: 0.6
weights_iptm: 0.75
weights_con_intra: 0.1
weights_con_inter: 0.2
weights_rg: 0.1
weights_helix: 0.1
weights_beta: 0.1

intra_contact_distance: 14.0
inter_contact_distance: 20.0
intra_contact_number: 2
inter_contact_number: 10
framework_contact_loss: true
framework_contact_offset: 1

# Hallucination settings
logits_steps: 40
softmax_steps: 15
search_steps: 10
search_mutation_rate: 0.05
plddt_threshold: 0.86
i_ptm_threshold: 0.75
i_pae_threshold: 0.23
seq_entropy_threshold: 0.085

# IgLM settings
grad_merge_method: "pcgrad"
iglm_scale: [0.1, 0.2, 0.4, 1.0]
iglm_temp: 0.6
iglm_species: "[HUMAN]"
seq_init_mode: ["gumbel", "soft"]  # STATIC: Fixed list, no argparse option
bias_redesign: 10
use_pos_distance: true
clear_best: true

# Sequence redesign settings
mpnn_fix_interface: true
num_seqs: 40
max_mpnn_sequences: 4
sampling_temp: 0.1
backbone_noise: 0.0
model_path: "abmpnn"
mpnn_weights: "abmpnn"

# Structure prediction settings
structure_model: "af3"
msa_mode: "target"

# AF3 configuration (required when structure_model == "af3")
af3_repo_path: "/large_storage/hielab/brk/models/alphafold3"
af3_sif_path: "/large_storage/hielab/brk/models/alphafold3/alphafold3_latest.sif"
af3_model_dir: "/large_storage/hielab/brk/models/af3_weights"
af3_db_dir: "/large_storage/hielab/brk/databases/af3_dbs"
msa_db_dir: "/large_storage/hielab/brk/databases/colabfold/"
use_metagenomic_db: false

# Template removal settings
rm_template_seq: true
rm_template_sc: false
rm_binder: false
rm_binder_seq: true
rm_binder_sc: true
rm_template_ic: true

###### REMAINING SETTINGS ######
# These settings are typically not changed from run to run.

# Model and Optimization settings
learning_rate: 0.1
optimizer: "sgd"
normalize_gradient: true
linear_lr_annealing: true
min_lr_scale: 0.25
use_multimer_design: true
sample_models: true
num_models: 1
num_recycles_design: 3
recycle_mode: "last"
soft_iterations: 60

# Other loss settings
use_helix_loss: true
use_beta_loss: true
beta_loss_type: "strand"
use_rg_loss: true
use_termini_distance_loss: false
use_i_ptm_loss: true

# File management settings
save_design_animations: false
save_design_trajectory_plots: false

# Other settings
omit_AAs: "C"
force_reject_AA: false
dgram_cce: 0.01
show_config: true

# Filter thresholds (moved from hardcoded values in code)
clash_threshold: 2.4           # Å for atomic clash detection
hotspot_distance_threshold: 5.3  # Å to consider residues near hotspots
residue_contact_distance: 6.0    # Å threshold for residue-residue contact
min_cdr_hotspot_contacts: 3      # minimum hotspot contacts in CDRs
sap_limit_sasa: 3.0              # minimal SASA in patch to consider
sap_patch_radius: 7.5            # Å radius for SAP patch
sap_avg_sasa_patch_thr: 1.5      # average SASA threshold per patch
atom_distance_cutoff: 3.0        # Å threshold for atom distance in redesign
